'use client'
import{d as l}from"./chunk-RKJYVIBZ.js";import{InputRule as q}from"@tiptap/core";import{Color as Nt}from"@tiptap/extension-color";import X from"@tiptap/extension-highlight";import j from"@tiptap/extension-horizontal-rule";import $t from"@tiptap/extension-image";import Bt from"@tiptap/extension-link";import F from"@tiptap/extension-placeholder";import{TaskItem as Wt}from"@tiptap/extension-task-item";import{TaskList as Gt}from"@tiptap/extension-task-list";import qt from"@tiptap/extension-text-style";import jt from"@tiptap/extension-underline";import Yt from"@tiptap/starter-kit";import{Markdown as Y}from"tiptap-markdown";import{Extension as m}from"@tiptap/core";var p=m.create({name:"CustomKeymap",addCommands(){return{selectTextWithinNodeBoundaries:()=>({editor:t,commands:r})=>{let{state:e}=t,{tr:o}=e,n=o.selection.$from.start(),i=o.selection.$to.end();return r.setTextSelection({from:n,to:i})}}},addKeyboardShortcuts(){return{"Mod-a":({editor:t})=>{let{state:r}=t,{tr:e}=r,o=e.selection.from,n=e.selection.to,i=e.selection.$from.start(),s=e.selection.$to.end();return o>i||n<s?(t.chain().selectTextWithinNodeBoundaries().run(),!0):!1}}}}),u=p;import{useCurrentEditor as g}from"@tiptap/react";import h from"react-moveable";import{jsx as T}from"react/jsx-runtime";var f=()=>{let{editor:t}=g();if(!t?.isActive("image"))return null;let r=()=>{let e=document.querySelector(".ProseMirror-selectednode");if(e){let o=t.state.selection,n=t.commands.setImage;n({src:e.src,width:Number(e.style.width.replace("px","")),height:Number(e.style.height.replace("px",""))}),t.commands.setNodeSelection(o.from)}};return T(h,{target:document.querySelector(".ProseMirror-selectednode"),container:null,origin:!1,edge:!1,throttleDrag:0,keepRatio:!0,resizable:!0,throttleResize:0,onResize:({target:e,width:o,height:n,delta:i})=>{i[0]&&(e.style.width=`${o}px`),i[1]&&(e.style.height=`${n}px`)},onResizeEnd:()=>{r()},scalable:!0,throttleScale:0,renderDirections:["w","e"],onScale:({target:e,transform:o})=>{e.style.transform=o}})};import{Node as x,mergeAttributes as y,nodePasteRule as b}from"@tiptap/core";import{NodeViewWrapper as R,ReactNodeViewRenderer as w}from"@tiptap/react";import{Tweet as H}from"react-tweet";import{jsx as d}from"react/jsx-runtime";var A=/(https?:\/\/)?(www\.)?x\.com\/([a-zA-Z0-9_]{1,15})(\/status\/(\d+))?(\/\S*)?/g,E=/^https?:\/\/(www\.)?x\.com\/([a-zA-Z0-9_]{1,15})(\/status\/(\d+))?(\/\S*)?$/,M=t=>t.match(E),S=({node:t})=>{let e=t?.attrs?.src?.split("/").pop();return e?d(R,{children:d("div",{"data-twitter":"",children:d(H,{id:e})})}):null},I=x.create({name:"twitter",addOptions(){return{addPasteHandler:!0,HTMLAttributes:{},inline:!1,origin:""}},addNodeView(){return w(S,{attrs:this.options.HTMLAttributes})},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null}}},parseHTML(){return[{tag:"div[data-twitter]"}]},addCommands(){return{setTweet:t=>({commands:r})=>M(t.src)?r.insertContent({type:this.name,attrs:t}):!1}},addPasteRules(){return this.options.addPasteHandler?[b({find:A,type:this.type,getAttributes:t=>({src:t.input})})]:[]},renderHTML({HTMLAttributes:t}){return["div",y({"data-twitter":""},t)]}});import"katex/dist/katex.min.css";import{Node as C,mergeAttributes as k}from"@tiptap/core";import"@tiptap/pm/state";import O from"katex";var L=C.create({name:"math",inline:!0,group:"inline",atom:!0,selectable:!0,marks:"",addAttributes(){return{latex:""}},addOptions(){return{shouldRender:(t,r)=>{let e=t.doc.resolve(r);return e.parent.isTextblock?e.parent.type.name!=="codeBlock":!1},katexOptions:{throwOnError:!1},HTMLAttributes:{}}},addCommands(){return{setLatex:({latex:t})=>({chain:r,state:e})=>{if(!t)return!1;let{from:o,to:n,$anchor:i}=e.selection;return this.options.shouldRender(e,i.pos)?r().insertContentAt({from:o,to:n},{type:"math",attrs:{latex:t}}).setTextSelection({from:o,to:o+1}).run():!1},unsetLatex:()=>({editor:t,state:r,chain:e})=>{let o=t.getAttributes(this.name).latex;if(typeof o!="string")return!1;let{from:n,to:i}=r.selection;return e().command(({tr:s})=>(s.insertText(o,n,i),!0)).setTextSelection({from:n,to:n+o.length}).run()}}},parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({node:t,HTMLAttributes:r}){let e=t.attrs.latex??"";return["span",k(r,{"data-type":this.name}),e]},renderText({node:t}){return t.attrs.latex??""},addNodeView(){return({node:t,HTMLAttributes:r,getPos:e,editor:o})=>{let n=document.createElement("span"),i=t.attrs.latex??"";return Object.entries(this.options.HTMLAttributes).forEach(([s,a])=>{n.setAttribute(s,a)}),Object.entries(r).forEach(([s,a])=>{n.setAttribute(s,a)}),n.addEventListener("click",s=>{if(o.isEditable&&typeof e=="function"){let a=e(),c=t.nodeSize;o.commands.setTextSelection({from:a,to:a+c})}}),n.contentEditable="false",n.innerHTML=O.renderToString(i,this.options.katexOptions),{dom:n}}}});import N from"@tiptap/extension-image";var P=N.extend({name:"image",addAttributes(){return{...this.parent?.(),width:{default:null},height:{default:null}}}}),v=P;import ne from"@tiptap/extension-character-count";import se from"@tiptap/extension-code-block-lowlight";import de from"@tiptap/extension-youtube";import ce from"tiptap-extension-global-drag-handle";import{Mark as z,markInputRule as $,markPasteRule as K,mergeAttributes as B}from"@tiptap/core";var D=/(?:^|\s)((?:==)((?:[^~=]+))(?:==))$/,V=/(?:^|\s)((?:==)((?:[^~=]+))(?:==))/g,Tt=z.create({name:"ai-highlight",addOptions(){return{HTMLAttributes:{}}},addAttributes(){return{color:{default:null,parseHTML:t=>t.getAttribute("data-color")||t.style.backgroundColor,renderHTML:t=>t.color?{"data-color":t.color,style:`background-color: ${t.color}; color: inherit`}:{}}}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:t}){return["mark",B(this.options.HTMLAttributes,t),0]},addCommands(){return{setAIHighlight:t=>({commands:r})=>r.setMark(this.name,t),toggleAIHighlight:t=>({commands:r})=>r.toggleMark(this.name,t),unsetAIHighlight:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleAIHighlight()}},addInputRules(){return[$({find:D,type:this.type})]},addPasteRules(){return[K({find:V,type:this.type})]}}),xt=t=>{let r=t.state.tr;r.removeMark(0,t.state.doc.nodeSize-2,t.state.schema.marks["ai-highlight"]),t.view.dispatch(r)},yt=(t,r)=>{t.chain().setAIHighlight({color:r??"#c1ecf970"}).run()};import{Extension as W}from"@tiptap/core";import{ReactRenderer as _}from"@tiptap/react";import G from"@tiptap/suggestion";import U from"tippy.js";var Mt=W.create({name:"slash-command",addOptions(){return{suggestion:{char:"/",command:({editor:t,range:r,props:e})=>{e.command({editor:t,range:r})}}}},addProseMirrorPlugins(){return[G({editor:this.editor,...this.options.suggestion})]}}),St=t=>{let r=null,e=null;return{onStart:o=>{r=new _(l,{props:o,editor:o.editor});let{selection:n}=o.editor.state;if(n.$from.node(n.$from.depth).type.name==="codeBlock")return!1;e=U("body",{getReferenceClientRect:o.clientRect,appendTo:()=>t?t.current:document.body,content:r.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start"})},onUpdate:o=>{r?.updateProps(o),e?.[0]?.setProps({getReferenceClientRect:o.clientRect})},onKeyDown:o=>o.event.key==="Escape"?(e?.[0]?.hide(),!0):r?.ref?.onKeyDown(o),onExit:()=>{e?.[0]?.destroy(),r?.destroy()}}},It=t=>t,Ct=t=>{if(["ArrowUp","ArrowDown","Enter"].includes(t.key)&&document.querySelector("#slash-command"))return!0};var me=F.configure({placeholder:({node:t})=>t.type.name==="heading"?`Heading ${t.attrs.level}`:"Press '/' for commands",includeChildren:!0}),pe=X.configure({multicolor:!0}),ue=Y.configure({html:!1,transformCopiedText:!0}),ge=j.extend({addInputRules(){return[new q({find:/^(?:---|â€”-|___\s|\*\*\*\s)$/u,handler:({state:t,range:r})=>{let e={},{tr:o}=t,n=r.from,i=r.to;o.insert(n-1,this.type.create(e)).delete(o.mapping.map(n),o.mapping.map(i))}})]}});export{Tt as AIHighlight,ne as CharacterCount,se as CodeBlockLowlight,Nt as Color,Mt as Command,u as CustomKeymap,ce as GlobalDragHandle,pe as HighlightExtension,ge as HorizontalRule,f as ImageResizer,q as InputRule,ue as MarkdownExtension,L as Mathematics,me as Placeholder,Yt as StarterKit,Wt as TaskItem,Gt as TaskList,qt as TextStyle,$t as TiptapImage,Bt as TiptapLink,jt as TiptapUnderline,I as Twitter,v as UpdatedImage,de as Youtube,yt as addAIHighlight,It as createSuggestionItems,Ct as handleCommandNavigation,D as inputRegex,V as pasteRegex,xt as removeAIHighlight,St as renderItems};
